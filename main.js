let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;

// 헬스냥
const catSvg1 = `<svg width="145" height="169" viewBox="0 0 145 169" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M90.5954 68.4295C113.949 52.5962 104.629 31.2139 96.8409 22.2099C96.681 22.0249 96.5954 21.7953 96.5954 21.5508V10.9295C96.5954 5.05936 92.7667 6.6871 90.728 8.32107C90.6391 8.39236 90.5657 8.47958 90.5076 8.57763L83.3776 20.6095C83.0093 21.2311 82.0375 21.319 81.3712 21.0395C78.0339 19.6399 70.0783 20.7682 65.4188 21.7499C64.9409 21.8506 64.4607 21.5993 64.2726 21.1486C62.6137 17.1734 59.2117 9.54075 56.5954 5.42947C53.8594 1.13005 51.2189 3.48243 50.1666 5.30268C50.1181 5.38661 50.0852 5.47764 50.0651 5.57248L46.6446 21.6975C46.6122 21.85 46.5431 21.9942 46.447 22.117C37.1194 34.0287 42.539 51.389 46.5115 58.7746C46.5682 58.88 46.638 58.9665 46.7288 59.0445C55.4752 66.5552 76.2688 78.7765 90.5954 68.4295Z" stroke="#191919" stroke-width="5"/>
<path d="M77.5954 40.4295C80.0954 37.2628 85.0954 33.4295 85.0954 43.4295" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M101.095 60.4295C103.313 55.8458 109.388 48.2976 117.433 50.5626C118.398 50.834 119.508 49.7379 119.096 48.825C117.471 45.2267 115.796 40.6972 115.865 37.9689C115.886 37.1052 115.245 35.698 114.41 35.4767C110.015 34.312 104.851 31.3761 108.595 25.9295C114.095 17.9295 118.095 17.9295 123.595 24.4295C129.095 30.9295 146.595 36.4295 140.095 53.9295C133.656 71.2676 137.031 76.3359 111.323 85.1807C110.902 85.3255 110.612 85.7348 110.605 86.1799C110.475 94.2212 103.55 116.151 93.0954 128.929" stroke="#191919" stroke-width="5" stroke-linecap="round"/>
<path d="M81.5954 47.4295C80.5954 51.9295 76.3954 58.4295 67.5954 48.4295" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M44.5954 55.9295C40.762 52.5961 30.0954 47.6295 18.0954 54.4295C24.022 52.0268 34.2591 45.0981 29.7208 36.0403C29.4309 35.4617 29.6849 34.7325 30.2892 34.5006C33.8717 33.1257 38.8845 30.4342 37.0954 27.9295C34.5954 24.4295 36.0954 14.9295 26.0954 22.9295C19.5249 28.1859 17.9011 32.0032 17.9 33.9383C17.8996 34.4985 17.6831 35.124 17.1845 35.3793C10.3927 38.8578 -0.493185 47.1347 4.09539 55.9295C6.56118 59.8747 3.19009 84.7354 38.1189 84.4558C38.8185 84.4502 39.3562 85.1371 39.1937 85.8176C38.1689 90.1089 38.1637 97.6417 44.5954 101.929C48.1954 103.929 46.0954 108.763 44.5954 110.929" stroke="#191919" stroke-width="5" stroke-linecap="round"/>
<path d="M73.5954 89.9295C68.7621 93.0961 57.9954 98.9295 53.5954 96.9295" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M83.0954 91.9295C82.7621 97.7628 84.2954 108.929 93.0954 106.929" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M76.0954 100.429C73.762 105.763 69.7954 117.129 72.5954 119.929" stroke="#191919" stroke-width="2" stroke-linecap="round"/>
<path d="M68.0954 105.429C71.0954 105.429 77.6954 106.229 80.0954 109.429" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M67.0954 114.429C69.0954 113.929 73.8954 113.429 77.0954 115.429" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M71.0954 42.4295C71.2621 37.9295 70.3954 30.6295 65.5954 37.4295L63.5954 40.9295" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M42.5954 112.429C38.9287 116.429 32.6954 125.729 37.0954 130.929C41.3261 135.929 39.116 138.248 37.3099 138.864C37.1697 138.911 37.0404 138.977 36.9282 139.073C30.3125 144.766 18.9812 155.829 22.2935 158.108C22.7027 158.389 23.0531 158.805 23.1701 159.287C23.7509 161.683 27.6264 164.348 40.0954 160.429C53.912 156.087 61.0731 144.57 63.0206 139.142C63.072 138.999 63.15 138.873 63.2617 138.77C65.2264 136.954 70.2678 134.656 76.0954 138.929C77.9328 140.014 81.8803 144.585 84.0608 147.266C84.3712 147.648 84.9408 147.733 85.3701 147.493C102.453 137.932 80.6963 155.052 87.5954 163.429C93.1954 170.229 102.929 160.596 107.095 154.929C112.262 148.429 121.395 132.929 116.595 122.929C111.795 112.929 98.9287 124.096 93.0954 130.929" stroke="#191919" stroke-width="5" stroke-linecap="round"/>
</svg>
`;
const catSvg2 = `<svg width="145" height="166" viewBox="0 0 145 166" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M90.6908 68.4295C114.045 52.5962 104.724 31.2139 96.9363 22.2099C96.7764 22.0249 96.6908 21.7953 96.6908 21.5508V10.9295C96.6908 5.05936 92.8621 6.6871 90.8234 8.32107C90.7345 8.39236 90.6611 8.47958 90.603 8.57763L83.473 20.6095C83.1047 21.2311 82.1329 21.319 81.4666 21.0395C78.1293 19.6399 70.1737 20.7682 65.5142 21.7499C65.0363 21.8506 64.5561 21.5993 64.368 21.1486C62.7091 17.1734 59.3071 9.54075 56.6908 5.42947C53.9548 1.13005 51.3143 3.48243 50.262 5.30268C50.2135 5.38661 50.1806 5.47764 50.1605 5.57248L46.74 21.6975C46.7076 21.85 46.6385 21.9942 46.5424 22.117C37.2148 34.0287 42.6344 51.389 46.6069 58.7746C46.6636 58.88 46.7334 58.9665 46.8242 59.0445C55.5706 66.5552 76.3642 78.7765 90.6908 68.4295Z" stroke="#191919" stroke-width="5"/>
<path d="M77.6908 40.4295C80.1908 37.2628 85.1908 33.4295 85.1908 43.4295" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M101.191 60.4295C103.409 55.8458 109.483 48.2976 117.529 50.5626C118.493 50.834 119.604 49.7379 119.191 48.825C117.566 45.2267 115.892 40.6972 115.96 37.9689C115.982 37.1052 115.341 35.698 114.505 35.4767C110.11 34.312 104.946 31.3761 108.691 25.9295C114.191 17.9295 118.191 17.9295 123.691 24.4295C129.191 30.9295 146.691 36.4295 140.191 53.9295C133.751 71.2676 137.127 76.3359 111.419 85.1807C110.998 85.3255 110.707 85.7348 110.7 86.1799C110.571 94.2212 103.646 116.151 93.1908 128.929" stroke="#191919" stroke-width="5" stroke-linecap="round"/>
<path d="M81.6908 47.4295C80.6908 51.9295 76.4908 58.4295 67.6908 48.4295" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M44.6908 55.9295C40.8574 52.5961 30.1908 47.6295 18.1908 54.4295C24.1174 52.0268 34.3545 45.0981 29.8162 36.0403C29.5263 35.4617 29.7803 34.7325 30.3846 34.5006C33.9671 33.1257 38.9799 30.4342 37.1908 27.9295C34.6908 24.4295 36.1908 14.9295 26.1908 22.9295C19.6203 28.1859 17.9965 32.0032 17.9953 33.9383C17.995 34.4985 17.7785 35.124 17.2799 35.3793C10.4881 38.8578 -0.397787 47.1347 4.19078 55.9295C6.65657 59.8747 3.28549 84.7354 38.2143 84.4558C38.9139 84.4502 39.4516 85.1371 39.2891 85.8176C38.2643 90.1089 38.2591 97.6417 44.6908 101.929C48.2908 103.929 46.1908 108.763 44.6908 110.929" stroke="#191919" stroke-width="5" stroke-linecap="round"/>
<path d="M73.6908 89.9295C68.8575 93.0961 58.0908 98.9295 53.6908 96.9295" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M83.1908 91.9295C82.8575 97.7628 84.3908 108.929 93.1908 106.929" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M76.1908 100.429C73.8574 105.763 69.8908 117.129 72.6908 119.929" stroke="#191919" stroke-width="2" stroke-linecap="round"/>
<path d="M68.1908 105.429C71.1908 105.429 77.7908 106.229 80.1908 109.429" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M67.1908 114.429C69.1908 113.929 73.9908 113.429 77.1908 115.429" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M71.1908 42.4295C71.3575 37.9295 70.4908 30.6295 65.6908 37.4295L63.6908 40.9295" stroke="#191919" stroke-width="3" stroke-linecap="round"/>
<path d="M43.6908 112.429C40.731 119.994 42.3462 136.286 71.9702 141.715C72.5912 141.828 72.9804 142.48 72.7706 143.075C70.6939 148.969 68.3681 159.098 73.0451 160.393C73.1392 160.419 73.2313 160.453 73.3164 160.501C78.0387 163.149 88.1228 166.048 91.6908 156.929C96.1908 145.429 101.191 142.429 94.1908 131.429C88.5908 122.629 80.1908 121.429 76.6908 121.929" stroke="#191919" stroke-width="5" stroke-linecap="round"/>
<path d="M49.1908 131.929C42.8575 136.596 31.9909 146.629 37.1909 151.429C43.6909 157.429 52.6908 152.429 70.6908 141.929" stroke="#191919" stroke-width="5" stroke-linecap="round"/>
</svg>
`;
// catSvg1과 catSvg2를 이미지 객체로 변환
const catImages = [new Image(), new Image()];
catImages[0].src = "data:image/svg+xml," + encodeURIComponent(catSvg1);
catImages[1].src = "data:image/svg+xml," + encodeURIComponent(catSvg2);

let currentCat = 0;

let muscleCat = {
  x: 20,
  y: 120,
  width: 50,
  height: 60,
  draw() {
    ctx.drawImage(
      catImages[currentCat],
      this.x,
      this.y,
      this.width,
      this.height
    );
  },
  jump() {
    this.y -= 7;
  },
  fall() {
    if (this.y < 10) {
      this.y += 8;
    }
  },
};

// 장애물
let boxImage = new Image();
boxImage.src = "/image/box.svg";
class Box {
  constructor() {
    this.width = 32;
    this.height = 24;
    this.x = canvas.width - this.width;
    this.y = 156;
  }
  draw() {
    ctx.drawImage(boxImage, this.x, this.y, this.width, this.height);
  }
}

let timer = 0;
let jumpTimer = 0;
let manyBoxes = [];
let animation;

// 프레임마다 실행하기
function frameRun() {
  animation = requestAnimationFrame(frameRun);
  timer++;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 이미지 교체 처리
  if (timer % 10 === 0) {
    currentCat = (currentCat + 1) % 2;
  }
  // 프레임마다 장애물 소환
  if (timer % 120 === 0) {
    let box = new Box();
    manyBoxes.push(box);
  }
  // x좌표가 0미만이면 제거
  manyBoxes.forEach((a, i, o) => {
    if (a.x < 0) {
      o.splice(i, 1);
    }
    a.x--;
    // 충돌 체크
    crash(muscleCat, a);
    a.draw();
  });

  // 점프!
  if (jumpSwitch == true) {
    muscleCat.jump();
    jumpTimer++;
  }
  if (jumpSwitch == false) {
    if (muscleCat.y < 120) {
      muscleCat.y++;
    }
  }
  if (jumpTimer > 10) {
    jumpSwitch = false;
    jumpTimer = 0;
  }
  muscleCat.draw();
}
frameRun();

// 충돌확인
function crash(muscleCat, box) {
  let xCalculate = box.x - (muscleCat.x + muscleCat.width);
  let yCalculate = box.y - (muscleCat.y + muscleCat.height);
  if (xCalculate < 0 && yCalculate < 0) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    cancelAnimationFrame(animation);
  }
}

var jumpSwitch = false;
// 헬스냥 spaceBar
document.addEventListener("keydown", function (e) {
  if (e.code === "Space") {
    jumpSwitch = true;
  }
});
